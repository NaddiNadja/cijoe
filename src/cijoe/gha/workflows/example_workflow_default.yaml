---
doc: |
  GitHub Action Runner

  Note
  ----

  The scripts assume you are running with a transport configuration for a
  non-root user and that the user has passwordless sudo privileges.

steps:
- name: diskimage_from_cloudimage
  uses: system_imaging.diskimage_from_cloudimage
  with:
    pattern: "debian-12-x86_64"

- name: guest_initialize
  uses: qemu.guest_initialize
  with:
    guest_name: generic-bios-kvm-x86_64
    system_image_name: debian-12-x86_64

- name: guest_start
  uses: qemu.guest_start
  with:
    guest_name: generic-bios-kvm-x86_64

- name: guest_check
  run: |
    hostname

# Create the non-root user necessary for creating GHA runners
- name: create_devuser
  run: |
    sudo useradd -m -d /home/devuser devuser

- name: download
  uses: gha.runner_download

- name: setup
  uses: gha.runner_setup

- name: remove
  uses: gha.runner_remove

- name: guest_kill
  uses: qemu.guest_kill
  with:
    guest_name: generic-bios-kvm-x86_64
